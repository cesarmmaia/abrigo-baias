<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Desinfecção de Baias</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .status-badge {
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: 700;
            border-radius: 0.375rem;
        }
        .status-ok {
            background-color: #28a745;
            color: white;
        }
        .status-proximo {
            background-color: #ffc107;
            color: black;
        }
        .status-pendente {
            background-color: #dc3545;
            color: white;
        }
        .status-agendado {
            background-color: #17a2b8;
            color: white;
        }
        .baia-dropdown {
            max-height: 200px;
            overflow-y: auto;
        }
        .table-hover tbody tr:hover {
            background-color: rgba(44, 62, 80, 0.05);
        }
        .nav-tabs .nav-link.active {
            font-weight: 600;
        }
        .agendamento-card {
            border-left: 4px solid #17a2b8;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0">Sistema de Gestão de Desinfecção de Baias</h1>
                <div>
                    <a href="/agendamentos" class="btn btn-outline-light btn-sm me-2">
                        <i class="bi bi-calendar"></i> Agendamentos
                    </a>
                    <a href="/relatorio" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-bar-chart"></i> Relatórios
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="container mt-4">
        <!-- Abas de Navegação -->
        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="registro-tab" data-bs-toggle="tab" data-bs-target="#registro" type="button" role="tab">
                    <i class="bi bi-plus-circle"></i> Nova Desinfecção
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="historico-tab" data-bs-toggle="tab" data-bs-target="#historico" type="button" role="tab">
                    <i class="bi bi-clock-history"></i> Últimas Desinfecções
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="agendamentos-tab" data-bs-toggle="tab" data-bs-target="#agendamentos" type="button" role="tab">
                    <i class="bi bi-calendar-check"></i> Próximos Agendamentos
                </button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <!-- ABA 1: Registro de Desinfecção -->
            <div class="tab-pane fade show active" id="registro" role="tabpanel">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="h5 mb-0"><i class="bi bi-droplet"></i> Registrar Desinfecção</h2>
                            </div>
                            <div class="card-body">
                                <form id="formDesinfeccao">
                                    <div class="mb-3">
                                        <label for="numero_baia" class="form-label">Número da Baia *</label>
                                        <div class="dropdown">
                                            <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="dropdownBaia" data-bs-toggle="dropdown" aria-expanded="false">
                                                Selecione uma baia
                                            </button>
                                            <input type="hidden" id="numero_baia" name="numero_baia" required>
                                            <ul class="dropdown-menu baia-dropdown w-100" aria-labelledby="dropdownBaia">
                                                <li><h6 class="dropdown-header">Baias Disponíveis (1-20)</h6></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <!-- Baias serão geradas via JavaScript -->
                                            </ul>
                                        </div>
                                        <div class="form-text" id="infoProximaDesinfeccao"></div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="data_desinfeccao" class="form-label">Data da Desinfecção *</label>
                                        <input type="date" class="form-control" id="data_desinfeccao" name="data_desinfeccao" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="metodo" class="form-label">Método Utilizado *</label>
                                        <select class="form-select" id="metodo" name="metodo" required>
                                            <option value="">Selecione um método</option>
                                            <option value="hipoclorito">Hipoclorito</option>
                                            <option value="ozonio">Ozônio</option>
                                            <option value="vapor">Vapor</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="observacao" class="form-label">Observações</label>
                                        <textarea class="form-control" id="observacao" name="observacao" rows="2" placeholder="Informações adicionais sobre a desinfecção"></textarea>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-check-circle"></i> Registrar Desinfecção
                                        </button>
                                        <button type="button" class="btn btn-outline-info" onclick="mostrarFormAgendamento()">
                                            <i class="bi bi-calendar-plus"></i> Agendar para depois
                                        </button>
                                    </div>
                                </form>

                                <!-- Formulário de Agendamento (inicialmente oculto) -->
                                <div id="formAgendamentoContainer" class="mt-4" style="display: none;">
                                    <div class="card agendamento-card">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="bi bi-calendar"></i> Agendar Desinfecção</h6>
                                        </div>
                                        <div class="card-body">
                                            <form id="formAgendamento">
                                                <div class="mb-3">
                                                    <label class="form-label">Data do Agendamento *</label>
                                                    <input type="date" class="form-control" id="dataAgendamento" required>
                                                </div>
                                                <div class="d-flex gap-2">
                                                    <button type="submit" class="btn btn-info flex-fill">
                                                        <i class="bi bi-calendar-check"></i> Confirmar Agendamento
                                                    </button>
                                                    <button type="button" class="btn btn-outline-secondary" onclick="ocultarFormAgendamento()">
                                                        <i class="bi bi-x"></i> Cancelar
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <!-- Card de Status das Baias -->
                        <div class="card">
                            <div class="card-header">
                                <h2 class="h5 mb-0"><i class="bi bi-info-circle"></i> Status das Baias</h2>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-3">
                                        <div class="status-badge status-ok mb-2">No Prazo</div>
                                        <small class="text-muted">≤ 9 dias</small>
                                    </div>
                                    <div class="col-3">
                                        <div class="status-badge status-proximo mb-2">Próximo</div>
                                        <small class="text-muted">10-14 dias</small>
                                    </div>
                                    <div class="col-3">
                                        <div class="status-badge status-pendente mb-2">Pendente</div>
                                        <small class="text-muted">≥ 15 dias</small>
                                    </div>
                                    <div class="col-3">
                                        <div class="status-badge status-agendado mb-2">Agendado</div>
                                        <small class="text-muted">Futuro</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card de Estatísticas Rápidas -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <h2 class="h5 mb-0"><i class="bi bi-speedometer2"></i> Estatísticas</h2>
                            </div>
                            <div class="card-body">
                                <div class="row text-center" id="estatisticasRapidas">
                                    <div class="col-4">
                                        <div class="h4 mb-1" id="totalDesinfeccoes">0</div>
                                        <small class="text-muted">Total</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="h4 mb-1 text-success" id="desinfeccoesOk">0</div>
                                        <small class="text-muted">No Prazo</small>
                                    </div>
                                    <div class="col-4">
                                        <div class="h4 mb-1 text-warning" id="agendamentosPendentes">0</div>
                                        <small class="text-muted">Agendados</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Próximos Agendamentos (Preview) -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <h2 class="h5 mb-0"><i class="bi bi-alarm"></i> Próximos 3 Agendamentos</h2>
                            </div>
                            <div class="card-body p-0">
                                <ul class="list-group list-group-flush" id="listaAgendamentosPreview">
                                    <li class="list-group-item text-center text-muted py-3">
                                        <i class="bi bi-inbox"></i><br>
                                        Nenhum agendamento
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 2: Histórico de Desinfecções -->
            <div class="tab-pane fade" id="historico" role="tabpanel">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h2 class="h5 mb-0"><i class="bi bi-list-check"></i> Histórico de Desinfecções</h2>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-secondary" onclick="exportarHistorico()">
                                <i class="bi bi-download"></i> Exportar
                            </button>
                            <a href="/relatorio" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-bar-chart"></i> Relatório Completo
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Baia</th>
                                        <th>Data</th>
                                        <th>Método</th>
                                        <th>Observação</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="listaDesinfeccoes">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="bi bi-inbox display-4 d-block mb-2"></i>
                                            Nenhuma desinfecção registrada
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 3: Agendamentos -->
            <div class="tab-pane fade" id="agendamentos" role="tabpanel">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h2 class="h5 mb-0"><i class="bi bi-calendar-check"></i> Agendamentos Programados</h2>
                        <a href="/agendamentos" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-calendar-month"></i> Ver Calendário Completo
                        </a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Baia</th>
                                        <th>Data Prevista</th>
                                        <th>Método</th>
                                        <th>Observação</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="listaAgendamentosCompleta">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="bi bi-calendar-x display-4 d-block mb-2"></i>
                                            Nenhum agendamento programado
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Confirmação -->
    <div class="modal fade" id="modalConfirmacao" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitulo">Operação Realizada</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalMensagem">
                    <!-- Conteúdo dinâmico -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" onclick="location.reload()">Nova Operação</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Realizar Agendamento -->
    <div class="modal fade" id="modalRealizarAgendamento" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Realizar Agendamento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Confirmar realização da desinfecção da <strong id="modalBaia"></strong>?</p>
                    <div class="mb-3">
                        <label class="form-label">Data de Realização</label>
                        <input type="date" class="form-control" id="dataRealizacao" value="{{ now().strftime('%Y-%m-%d') }}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="confirmarRealizacao()">
                        <i class="bi bi-check-circle"></i> Confirmar Realização
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variáveis globais
        let selectedAgendamentoId = null;
        let currentBaiaForAgendamento = null;

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            inicializarDropdownBaias();
            carregarDadosIniciais();
            configurarEventListeners();
        });

        function inicializarDropdownBaias() {
            const dropdownMenu = document.querySelector('.baia-dropdown');
            const dropdownButton = document.getElementById('dropdownBaia');
            const hiddenInput = document.getElementById('numero_baia');
            
            // Gerar 20 baias
            for (let i = 1; i <= 20; i++) {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.className = 'dropdown-item';
                a.href = '#';
                a.textContent = `Baia ${i}`;
                a.onclick = function(e) {
                    e.preventDefault();
                    dropdownButton.textContent = `Baia ${i}`;
                    hiddenInput.value = i;
                    currentBaiaForAgendamento = i;
                    hiddenInput.setCustomValidity('');
                    carregarInfoBaia(i);
                };
                li.appendChild(a);
                dropdownMenu.appendChild(li);
            }
        }

        async function carregarInfoBaia(numeroBaia) {
            try {
                const response = await fetch(`/api/proximo-agendamento/${numeroBaia}`);
                const data = await response.json();
                
                const infoElement = document.getElementById('infoProximaDesinfeccao');
                const dataInput = document.getElementById('data_desinfeccao');
                
                if (data.proxima_data) {
                    infoElement.innerHTML = `
                        <span class="text-success">
                            <i class="bi bi-info-circle"></i> Próxima desinfecção recomendada: 
                            ${new Date(data.proxima_data).toLocaleDateString('pt-BR')}
                        </span>
                    `;
                    dataInput.value = data.proxima_data;
                } else {
                    const intervalo = data.intervalo_dias || 15;
                    const hoje = new Date();
                    hoje.setDate(hoje.getDate() + intervalo);
                    dataInput.value = hoje.toISOString().split('T')[0];
                    infoElement.innerHTML = `
                        <span class="text-info">
                            <i class="bi bi-info-circle"></i> Primeira desinfecção - intervalo padrão: ${intervalo} dias
                        </span>
                    `;
                }
            } catch (error) {
                console.error('Erro ao carregar informações da baia:', error);
            }
        }

        async function carregarDadosIniciais() {
            await Promise.all([
                carregarDesinfeccoes(),
                carregarAgendamentos(),
                carregarEstatisticas()
            ]);
        }

        async function carregarDesinfeccoes() {
            try {
                const response = await fetch('/desinfeccoes');
                const desinfeccoes = await response.json();
                exibirDesinfeccoes(desinfeccoes);
            } catch (error) {
                console.error('Erro ao carregar desinfecções:', error);
            }
        }

        async function carregarAgendamentos() {
            try {
                const response = await fetch('/api/agendamentos');
                const agendamentos = await response.json();
                exibirAgendamentosPreview(agendamentos.slice(0, 3));
                exibirAgendamentosCompletos(agendamentos);
            } catch (error) {
                console.error('Erro ao carregar agendamentos:', error);
            }
        }

        async function carregarEstatisticas() {
            try {
                const [responseDesinfeccoes, responseAgendamentos] = await Promise.all([
                    fetch('/desinfeccoes'),
                    fetch('/api/agendamentos')
                ]);
                
                const desinfeccoes = await responseDesinfeccoes.json();
                const agendamentos = await responseAgendamentos.json();
                
                // Calcular estatísticas
                const hoje = new Date();
                const desinfeccoesOk = desinfeccoes.filter(d => {
                    const dataDesinfeccao = new Date(d.data_desinfeccao);
                    const diasDiff = Math.floor((hoje - dataDesinfeccao) / (1000 * 60 * 60 * 24));
                    return diasDiff < 10;
                }).length;
                
                document.getElementById('totalDesinfeccoes').textContent = desinfeccoes.length;
                document.getElementById('desinfeccoesOk').textContent = desinfeccoesOk;
                document.getElementById('agendamentosPendentes').textContent = agendamentos.length;
            } catch (error) {
                console.error('Erro ao carregar estatísticas:', error);
            }
        }

        function configurarEventListeners() {
            // Validação do formulário principal
            document.getElementById('formDesinfeccao').addEventListener('submit', salvarDesinfeccao);
            
            // Formulário de agendamento
            document.getElementById('formAgendamento').addEventListener('submit', salvarAgendamento);
            
            // Data atual como padrão para os campos de data
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('data_desinfeccao').value = hoje;
            document.getElementById('dataAgendamento').value = hoje;
        }

        function mostrarFormAgendamento() {
            if (!currentBaiaForAgendamento) {
                alert('Por favor, selecione uma baia primeiro.');
                return;
            }
            document.getElementById('formAgendamentoContainer').style.display = 'block';
        }

        function ocultarFormAgendamento() {
            document.getElementById('formAgendamentoContainer').style.display = 'none';
        }

        async function salvarDesinfeccao(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const desinfeccao = {
                numero_baia: parseInt(formData.get('numero_baia')),
                data_desinfeccao: formData.get('data_desinfeccao'),
                metodo: formData.get('metodo'),
                observacao: formData.get('observacao')
            };
            
            try {
                const response = await fetch('/desinfeccoes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(desinfeccao)
                });
                
                if (response.ok) {
                    mostrarModalSucesso(
                        'Desinfecção Registrada',
                        `Desinfecção da Baia ${desinfeccao.numero_baia} registrada com sucesso!`
                    );
                    limparFormulario();
                    carregarDadosIniciais();
                } else {
                    throw new Error('Erro ao salvar desinfecção');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao salvar desinfecção. Verifique o console para detalhes.');
            }
        }

        async function salvarAgendamento(event) {
            event.preventDefault();
            
            if (!currentBaiaForAgendamento) {
                alert('Por favor, selecione uma baia primeiro.');
                return;
            }
            
            const agendamento = {
                numero_baia: currentBaiaForAgendamento,
                data_agendamento: document.getElementById('dataAgendamento').value,
                metodo: document.getElementById('metodo').value,
                observacao: document.getElementById('observacao').value
            };
            
            try {
                const response = await fetch('/api/agendamentos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(agendamento)
                });
                
                if (response.ok) {
                    mostrarModalSucesso(
                        'Agendamento Criado',
                        `Desinfecção da Baia ${agendamento.numero_baia} agendada para ${new Date(agendamento.data_agendamento).toLocaleDateString('pt-BR')}`
                    );
                    ocultarFormAgendamento();
                    carregarDadosIniciais();
                } else {
                    throw new Error('Erro ao criar agendamento');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao criar agendamento. Verifique o console para detalhes.');
            }
        }

        function mostrarModalSucesso(titulo, mensagem) {
            document.getElementById('modalTitulo').textContent = titulo;
            document.getElementById('modalMensagem').innerHTML = mensagem;
            const modal = new bootstrap.Modal(document.getElementById('modalConfirmacao'));
            modal.show();
        }

        function limparFormulario() {
            document.getElementById('formDesinfeccao').reset();
            document.getElementById('dropdownBaia').textContent = 'Selecione uma baia';
            document.getElementById('numero_baia').value = '';
            currentBaiaForAgendamento = null;
            document.getElementById('infoProximaDesinfeccao').textContent = '';
        }

        // ... (outras funções existentes como exibirDesinfeccoes, exibirAgendamentosPreview, etc.)

        // Funções para manipulação de agendamentos
        function abrirModalRealizar(id, numeroBaia) {
            selectedAgendamentoId = id;
            document.getElementById('modalBaia').textContent = `Baia ${numeroBaia}`;
            document.getElementById('dataRealizacao').value = new Date().toISOString().split('T')[0];
            
            const modal = new bootstrap.Modal(document.getElementById('modalRealizarAgendamento'));
            modal.show();
        }

        async function confirmarRealizacao() {
            try {
                const dataRealizacao = document.getElementById('dataRealizacao').value;
                
                const response = await fetch(`/api/agendamentos/${selectedAgendamentoId}/realizar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data_realizacao: dataRealizacao })
                });
                
                if (response.ok) {
                    mostrarModalSucesso('Agendamento Realizado', 'Desinfecção realizada com sucesso!');
                    $('#modalRealizarAgendamento').modal('hide');
                    carregarDadosIniciais();
                } else {
                    throw new Error('Erro ao realizar agendamento');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao realizar agendamento.');
            }
        }

        async function cancelarAgendamento(id) {
            if (!confirm('Tem certeza que deseja cancelar este agendamento?')) return;
            
            try {
                const response = await fetch(`/api/agendamentos/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Agendamento cancelado com sucesso!');
                    carregarDadosIniciais();
                } else {
                    throw new Error('Erro ao cancelar agendamento');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao cancelar agendamento.');
            }
        }

        function exportarHistorico() {
            alert('Funcionalidade de exportação será implementada em breve!');
        }

        // Funções de exibição (mantenha as existentes e adicione as novas)
        function exibirAgendamentosPreview(agendamentos) {
            const lista = document.getElementById('listaAgendamentosPreview');
            lista.innerHTML = '';
            
            if (agendamentos.length === 0) {
                lista.innerHTML = `
                    <li class="list-group-item text-center text-muted py-3">
                        <i class="bi bi-inbox"></i><br>
                        Nenhum agendamento
                    </li>
                `;
                return;
            }
            
            agendamentos.forEach(agendamento => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Baia ${agendamento.numero_baia}</strong>
                            <br>
                            <small class="text-muted">${new Date(agendamento.data_agendamento).toLocaleDateString('pt-BR')}</small>
                        </div>
                        <span class="status-badge status-agendado">Agendado</span>
                    </div>
                `;
                lista.appendChild(li);
            });
        }

        function exibirAgendamentosCompletos(agendamentos) {
            const tbody = document.getElementById('listaAgendamentosCompleta');
            tbody.innerHTML = '';
            
            if (agendamentos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            <i class="bi bi-calendar-x display-4 d-block mb-2"></i>
                            Nenhum agendamento programado
                        </td>
                    </tr>
                `;
                return;
            }
            
            agendamentos.forEach(agendamento => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>Baia ${agendamento.numero_baia}</td>
                    <td>${new Date(agendamento.data_agendamento).toLocaleDateString('pt-BR')}</td>
                    <td>${formatarMetodo(agendamento.metodo)}</td>
                    <td>${agendamento.observacao || '-'}</td>
                    <td><span class="status-badge status-agendado">Agendado</span></td>
                    <td>
                        <button class="btn btn-sm btn-success me-1" onclick="abrirModalRealizar(${agendamento.id}, ${agendamento.numero_baia})">
                            <i class="bi bi-check-circle"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="cancelarAgendamento(${agendamento.id})">
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function formatarMetodo(metodo) {
            const metodoMap = {
                'hipoclorito': 'Hipoclorito',
                'ozonio': 'Ozônio',
                'vapor': 'Vapor'
            };
            return metodoMap[metodo] || metodo;
        }

        // Função para exibir desinfecções (já existente)
        function exibirDesinfeccoes(desinfeccoes) {
            const tbody = document.getElementById('listaDesinfeccoes');
            // ... implementação existente
        }
    </script>
</body>
</html>